/*


רק לציין, לא הייתי בסדיר בחיל המודיעין, וגם במילואים אני לא משובץ לשם (מנסה לעבוד על זה, מקווה שאצליח...) ולכן
אין חשש שיש כאן איזשהו מידע מסווג או כל דבר שכזה...
דבר נוסף, כל הנתונים שיש כאן הם מומצאים. נעזרתי בבינה מאכותית כדי להכין טבלאות באקסל עם הנתונים המדוייקים שרציתי


*/



GO

--מחיקת דאתא בייס ישן ויצירת הדאתא בייס
USE master
GO
IF exists (select * from sysdatabases where name = 'Khan_Yunis')
				drop database Khan_Yunis

go

CREATE DATABASE Khan_Yunis

go

use Khan_Yunis
GO

--יצירת טבלא 1, אוכלוסיית חאן יונס
CREATE TABLE Population
(Po_ID_Number Char(9) not null
, FirstName NVarchar(12) NOT NULL
, LastName NVarchar(12) NOT NULL
, Gender NVARCHAR(4)
, Marital_Status NVARCHAR(7)
, Neighborhood NVARCHAR(20)
, Street NVARCHAR(20)
, House_Number INT
, Phone Char(12)
, BirthDate Date
, CONSTRAINT po_ID_pk PRIMARY KEY (Po_ID_Number)
, CONSTRAINT po_ID_ck CHECK (LEN(Po_ID_Number) = 9)
, CONSTRAINT po_Name_Uk UNIQUE (FirstName,LastName)
, CONSTRAINT po_gan_ck CHECK (Gender IN ('זכר','נקבה'))
, CONSTRAINT po_mar_ck CHECK (Marital_Status IN ('רווק','רווקה','נשוי','נשואה','פרוד','פרודה','גרוש','גרושה'))
, CONSTRAINT po_phone_ck CHECK (LEN(Phone) = 11)
, CONSTRAINT po_phone_Uk UNIQUE (Phone)
)
GO

--הכנסת נתונים לטבלא 1
INSERT INTO Population
VALUES 
(560056749,'איהאב','עודה','זכר','רווק','א-זאנה','המסגד הגדול',86,'059-3561595','1995-06-13'),
(560458838,'חסן','עדאס','נקבה','גרושה','א-סברה','המסגד הגדול',61,'059-1317127','1993-08-18'),
(560650395,'עבדאללה','שאהין','זכר','נשוי','אבו רוש','גמאל עבד אל נאצר',86,'059-0033092','2005-10-07'),
(560794046,'נגוא','זבידאת','זכר','פרוד','אל-עמל','גמאל עבד אל נאצר',15,'059-6541458','1980-05-06'),
(560973911,'עומר','סרסור','זכר','פרוד','אל-קידרה','גמאל עבד אל נאצר',83,'059-6272980','1995-03-28'),
(561943646,'עבדאללה','סולימאן','זכר','פרוד','אבו רוש','גמאל עבד אל נאצר',68,'059-1171822','1981-10-14'),
(562280388,'נגוא','אל-מסרי','זכר','רווק','א-סברה','המהפכה',120,'059-6193990','2000-04-22'),
(563449181,'עמאר','עודה','זכר','רווק','אבו רוש','המהפכה',101,'059-6923226','1995-11-28'),
(564048539,'אלאא','זבידאת','נקבה','גרושה','חירבת אל-קרארה','האוניברסיטה',38,'059-5182337','1995-06-06'),
(564072118,'סעיד','חמדאן','זכר','פרוד','אל-ברכה','האוניברסיטה',96,'059-7889579','1981-08-15'),
(564643063,'עלי','אל-מסרי','זכר','פרוד','א-סברה','האוניברסיטה',27,'059-6231665','1982-07-13'),
(564853379,'עומר','זבידאת','נקבה','רווקה','א-זאנה','האוניברסיטה',108,'059-9821465','1949-10-22'),
(566524163,'חנין','באכר','זכר','נשוי','אבו רוש','האוניברסיטה',7,'059-7632016','1991-04-28'),
(567106768,'חדיגה','עודה','זכר','רווק','א-סקאנ','הים',9,'059-3465787','1998-01-19'),
(567435541,'עומר','אל-מסרי','נקבה','גרושה','אל-עמל','הים',35,'059-4957885','1985-05-08'),
(568697025,'מרווה','אל-מסרי','זכר','גרוש','א-סקאנ','הים',43,'059-4873471','1998-09-03'),
(568874003,'יוסף','אבו סית','זכר','נשוי','א-זאנה','הים',33,'059-8244935','1980-01-03'),
(568880050,'נגוא','שאהין','נקבה','פרודה','אל-ברכה','הים',5,'059-2328120','1995-05-23'),
(568898649,'עלי','חליל','זכר','גרוש','אל-קידרה','המלך פייסל',120,'059-1354278','1987-02-05'),
(569486454,'חנין','דאוד','זכר','נשוי','א-זאנה','המלך פייסל',10,'059-1349361','2017-03-26'),
(569837430,'אמאל','חוסיין','זכר','רווק','א-סקאנ','המלך פייסל',49,'059-5931034','2000-08-21'),
(570142417,'אחמד','ברגותי','נקבה','פרודה','אל-ברכה','המלך פייסל',44,'059-8427109','2001-01-09'),
(570321739,'עימאד','סולימאן','נקבה','פרודה','חירבת אל-קרארה','המלך פייסל',114,'059-4717464','1969-12-11'),
(571247051,'איברהים','אל-מסרי','זכר','פרוד','חירבת אל-קרארה','המלך פייסל',54,'059-4332003','1980-11-19'),
(573456679,'סנאא','ברגותי','זכר','פרוד','אל-ברכה','התעשייה',25,'059-2606474','1999-04-02'),
(574546631,'עמאר','דאוד','נקבה','פרודה','א-סברה','התעשייה',42,'059-2628498','1993-02-09'),
(574625873,'יסמין','שנענה','זכר','גרוש','א-סברה','התעשייה',37,'059-1756551','1973-09-02'),
(575261425,'איברהים','סרסור','נקבה','פרודה','אל-קידרה','התעשייה',67,'059-4516808','1978-10-25'),
(575396513,'עלי','עבד רבו','זכר','פרוד','אל-עמל','התעשייה',18,'059-2388496','1992-08-03'),
(575492029,'חאלד','ברגותי','זכר','פרוד','א-זאנה','התעשייה',33,'059-4653755','1982-02-16'),
(575603951,'חנין','עבד רבו','זכר','רווק','א-זאנה','חאלד בן אל ווליד',51,'059-5299124','1999-02-19'),
(576429603,'רנא','חמדאן','נקבה','פרודה','אל-עמל','חאלד בן אל ווליד',90,'059-7875588','1994-10-13'),
(576726652,'יסמין','דאוד','נקבה','רווקה','אל-קידרה','חאלד בן אל ווליד',91,'059-0348247','2004-05-18'),
(578306972,'אחמד','חליל','זכר','גרוש','אל-קידרה','חאלד בן אל ווליד',27,'059-9826204','1987-04-22'),
(578586522,'עבדאללה','אבו סלאח','זכר','נשוי','א-זאנה','נאצר',28,'059-1031051','1991-03-24'),
(578688132,'עבדאללה','סרסור','זכר','נשוי','אל-עמל','נאצר',84,'059-0305641','1993-07-21'),
(579434065,'אלאא','עודה','זכר','נשוי','אל-קידרה','נאצר',109,'059-0500978','2003-02-20'),
(579481358,'סאלח','ברגותי','זכר','רווק','א-סברה','נאצר',33,'059-1965569','2007-12-14'),
(580002697,'נוהא','חוסיין','נקבה','גרושה','אל-קידרה','נאצר',98,'059-3867749','1998-11-07'),
(580200396,'מוחמד','עודה','זכר','רווק','אבו רוש','סלאח א דין',44,'059-3863794','2000-03-07'),
(580257268,'סאלח','אבו סלאח','זכר','נשוי','אל-ברכה','סלאח א דין',118,'059-1399049','1989-03-19'),
(581283054,'גמאל','עבד רבו','זכר','פרוד','אל-קידרה','סלאח א דין',10,'059-0052427','1980-12-05'),
(581439587,'איהאב','חוסיין','זכר','גרוש','אל-ברכה','סלאח א דין',15,'059-3252880','1997-05-08'),
(581455603,'יוסף','אבו סלאח','זכר','פרוד','אל-קידרה','סלאח א דין',12,'059-4332181','2002-04-17'),
(582594364,'יסמין','אבו סית','זכר','פרוד','אבו רוש','אל מונטאר',24,'059-0651333','2000-08-08'),
(583173174,'אמאל','אל-מסרי','נקבה','גרושה','חירבת אל-קרארה','אל מונטאר',2,'059-1491905','1971-08-04'),
(583394432,'ראמי','עודה','זכר','גרוש','א-סברה','עומר אל-מוחתאר',39,'059-2366299','1999-04-14'),
(584031409,'נור','אל-מסרי','זכר','רווק','אל-ברכה','עומר אל-מוחתאר',10,'059-4624751','1991-04-17'),
(584664438,'נוהא','אל-מסרי','זכר','נשוי','אל-ברכה','עומר אל-מוחתאר',40,'059-4216073','1982-04-08'),
(585359841,'אחמד','אבו סית','זכר','פרוד','א-זאנה','עומר אל-מוחתאר',88,'059-2269166','1985-02-22'),
(585618611,'נור','אבו סית','זכר','רווק','אל-ברכה','עומר בן אל חטאב',119,'059-1615594','1996-02-18'),
(585830059,'פואד','אבו סלאח','זכר','פרוד','א-סקאנ','עומר בן אל חטאב',29,'059-9670546','2000-07-16'),
(586365691,'פואד','חוסיין','זכר','נשוי','חירבת אל-קרארה','עומר בן אל חטאב',66,'059-5777387','1987-11-20'),
(587988101,'עמאר','אל-חאג','זכר','נשוי','אבו רוש','עומר בן אל חטאב',49,'059-5534192','2000-11-23'),
(588914624,'לאית','אבו סית','זכר','גרוש','חירבת אל-קרארה','פלסטין',16,'059-1671902','1953-07-20'),
(589342879,'חדיגה','שאהין','זכר','נשוי','אבו רוש','פלסטין',63,'059-7810801','1993-04-28'),
(589538636,'עימאד','עבד רבו','נקבה','נשואה','אל-ברכה','פלסטין',58,'059-8083136','2022-02-10'),
(589582633,'סעיד','אל-מסרי','נקבה','נשואה','אל-ברכה','פלסטין',46,'059-7996507','1991-06-09'),
(589607862,'פואד','סולימאן','זכר','פרוד','אל-עמל','פלסטין',53,'059-7376311','1994-12-02'),
(589688573,'חסן','עבד רבו','זכר','גרוש','אבו רוש','פלסטין',112,'059-5146270','1988-05-27')
go

--יצירת טבלא 2, פעילי החמאס שבעיר
CREATE TABLE Hamas_Forces
(Ha_ID_Number Char(9) not null
, Ha_Nickname NVarchar(12) NOT NULL
, Date_Of_Joining DATE 
, Ha_Commander_Nickname NVarchar(12)
, Trained NCHAR(2)
, Comment NVarchar(22)
, CONSTRAINT HF_ID_FK FOREIGN KEY (Ha_ID_Number) REFERENCES Population(Po_ID_Number)
, CONSTRAINT HF_Nick_PK PRIMARY KEY (Ha_Nickname)
, CONSTRAINT HF_DJoin_CK CHECK (Date_Of_Joining < GETDATE())
, CONSTRAINT HF_ComNick_FK FOREIGN KEY (Ha_Commander_Nickname) REFERENCES Hamas_Forces(Ha_Nickname)
, CONSTRAINT HF_Tr_CK CHECK (Trained in ('כן','לא'))
)
GO

--הכנסת נתונים לטבלא 2
INSERT INTO Hamas_Forces
VALUES 
('580200396','אבו קרערה','2018-02-21','אבו רבאח','כן',NULL),
('568898649','אל-דראוי','2009-07-16',NULL,'כן',NULL),
('564643063','אבו אסעד','2008-06-20','אבו רבאח','כן',NULL),
('580257268','אל-זינתי','2006-05-13','אבו עווד','כן','לא חושש למות'),
('561943646','אבו רבאח','2020-04-05','אל-דראוי','כן','לא חושש למות'),
('589342879','אבו נעים','2014-04-11','אבו רבאח','כן',NULL),
('575603951','אל-עזאזי','2023-08-10','אבו רבאח','כן','מועד לטעויות'),
('581455603','אל-מועלם','2023-08-10','אל-חנאגרי','כן','מסוכן מאוד'),
('582594364','אבו שאהין','2018-01-21','אבו רבאח','כן','נוטה להסתתר'),
('563449181','אבו מנסור','2013-11-17','אבו רבאח','כן','רמת סיכון בינונית'),
('581283054','אל-שווירי','2010-05-16','אבו רבאח','כן','לא חושש למות'),
('568874003','אל-קאסם','2010-12-12','אבו רבאח','כן','רמת סיכון בינונית'),
('575396513','אל-מקדסי','2016-09-15','אבו רבאח','כן',NULL),
('566524163','אל-רוחי','2011-06-16','אבו עווד','כן','מסוכן מאוד'),
('571247051','אל-חנאגרי','1999-01-08','אל-דראוי','כן',NULL),
('584664438','אבו קאסם','2013-03-04','אל-חנאגרי','כן',NULL),
('573456679','אל-עוקבי','2024-12-28','אל-חנאגרי','כן',NULL),
('585830059','אבו רוקן','2021-02-12','אבו רבאח','לא','רמת סיכון בינונית'),
('585618611','אבו סובחי','2022-07-31','אבו עווד','לא','מסוכן מאוד'),
('560056749','אבו עווד','2013-09-17','אל-דראוי','כן',NULL),
('579481358','אל-ברכאת','2025-03-11','אבו רבאח','לא',NULL),
('562280388','אבו מדיעם','2024-06-17','אבו רבאח','לא',NULL),
('568697025','אבו זעבול','2018-03-06','אבו עווד','לא','מועד לטעויות'),
('589607862','אבו חטואן','2020-05-16','אל-חנאגרי','לא',NULL),
('560650395','אבו חמאדה','2024-07-03','אבו עווד','לא',NULL)
GO

--יצירת טבלא 3, אנשי המודיעין בגיזרה
CREATE TABLE IDF_Intelligence
(PersonalNumber CHAR(7) NOT NULL
, IDF_ID_Number CHAR(9) NOT NULL
, FirstName NVarchar(12) NOT NULL
, LastName NVarchar(12) NOT NULL
, BirthDate DATE
, EnlistmentDate DATE NOT NULL
, ReleaseDate DATE
, Ranks NVarchar(12)
, Role NVarchar(15)
, CONSTRAINT Intel_PN_PK PRIMARY KEY (PersonalNumber)
, CONSTRAINT Intel_PN_CK CHECK (LEN(PersonalNumber) = 7)
, CONSTRAINT Intel_ID_UK UNIQUE (IDF_ID_Number)
, CONSTRAINT Intel_ID_CK CHECK (LEN(IDF_ID_Number) = 9)
, CONSTRAINT Intel_Name_UK UNIQUE (Firstname,Lastname)
)
GO

--הכנסת נתונים לטבלא 3
INSERT INTO IDF_Intelligence
VALUES
('5678390','987321654','נועם','פרץ','2004-04-15','2022-04-15','2027-09-10','סמל ראשון','האזנה'),
('6789450','789654123','רועי','אוחנה','2006-11-21','2024-11-21','2027-10-15','סמל','האזנה'),
('7049582','852741963','דניאל','לנדאו','2007-08-12','2025-08-12','2027-11-01','סמל','האזנה'),
('7582941','654321987','רון','גולדשטיין','2007-12-28','2025-12-28','2027-10-22','רב-טוראי','האזנה'),
('8457293','951486357','שירה','סער','2007-02-25','2025-02-25','2027-12-05','סמל ראשון','האזנה'),
('5928374','321987654','איתן','ישראלי','2006-06-05','2024-06-05','2027-11-05','סמל ראשון','חוקר מודיעין'),
('6982745','741963852','עדי','כץ','2007-05-24','2025-05-24','2027-09-25','סמל','חוקר מודיעין'),
('7438290','357951486','יואב','שחר','2007-12-17','2025-12-17','2027-12-30','רב-טוראי','חוקר מודיעין'),
('7873491','357159846','תמר','רון','2007-05-07','2025-05-07','2027-11-20','רב-טוראי','חוקר מודיעין'),
('8593740','753951486','מיכל','אביחי','2007-01-14','2025-01-14','2027-12-22','סמל ראשון','חוקר מודיעין'),
('8984736','753159486','רות','מלכה','2007-06-15','2025-06-15','2027-10-31','סמל ראשון','חוקר מודיעין'),
('3375648','123456789','דוד','כהן','1984-06-27','2002-07-01','2028-12-01','סגן אלוף','מפקד'),
('4523867','987654321','יונתן','לוי','1994-11-15','2012-12-01','2027-11-30','סרן','רמד איסוף'),
('4582736','123987654','אלעד','מזרחי','1995-01-20','2013-01-20','2028-05-15','סרן','רמד מחקר'),
('5789467','654987321','עומר','ברק','2005-01-30','2023-01-30','2027-12-01','סמל ראשון','תצפית'),
('6847391','963852741','מאור','רוזן','2007-03-10','2025-03-10','2028-01-01','סמל','תצפית'),
('7283947','159753486','גיא','שמש','2007-10-03','2025-10-03','2028-02-15','רב-טוראי','תצפית'),
('7638294','951753486','אלון','דגן','2007-11-11','2025-11-11','2028-03-05','רב-טוראי','תצפית'),
('8723451','486357159','אלונה','כהן-לוי','2007-03-29','2025-03-29','2028-01-11','סמל ראשון','תצפית'),
('8857394','159486357','אביגיל','פרידמן','2007-04-02','2025-04-02','2027-11-15','סמל ראשון','תצפית')
GO


--יצירת טבלא 4, תצפיות וזיהוי מחבלים במרחב
CREATE TABLE Observation
(ObservationTimeStamp DATETIME NOT NULL
, ObservationStreet NVarChar(20) NOT NULL
, ObservationHouseNumber VarChar(3)
, Ha_Nickname NVarchar(12) NOT NULL
, IdentifierPN CHAR(7) NOT NULL
, CONSTRAINT Ob_Nick_FK FOREIGN KEY (Ha_Nickname) REFERENCES Hamas_Forces(Ha_Nickname)
, CONSTRAINT Ob_Iden_FK FOREIGN KEY (IdentifierPN) REFERENCES IDF_Intelligence(PersonalNumber)
)
GO

--הכנסת נתונים לטבלא 4
INSERT INTO Observation
VALUES 
('2024-01-21 08:12:35','פלסטין','12','אבו קרערה','5789467'),
('2024-01-21 08:12:35','פלסטין','12','אל-דראוי','5789467'),
('2024-01-21 08:12:35','פלסטין','12','אבו אסעד','5789467'),
('2024-01-21 10:45:10','אחדות','34','אל-זינתי','6847391'),
('2024-01-21 10:45:10','אחדות','34','אבו רבאח','6847391'),
('2024-01-21 12:30:00','עומר אל-מוחתאר','5','אבו נעים','7283947'),
('2024-01-21 15:17:22','נאצר','9','אל-עזאזי','8723451'),
('2024-01-22 09:55:55','גמאל עבד אל נאצר','56','אל-מועלם','8857394'),
('2024-01-22 09:55:55','גמאל עבד אל נאצר','56','אבו שאהין','8857394'),
('2024-01-22 11:22:10','עומר בן אל-חטאב','78','אבו מנסור','5789467'),
('2024-01-22 14:00:45','סלאח א דין','43','אל-שווירי','6847391'),
('2024-01-22 18:30:30','המלך פייסל','88','אל-קאסם','7283947'),
('2024-01-23 08:05:05','חאלד בן אל-ווליד','31','אל-מקדסי','7638294'),
('2024-01-23 08:05:05','חאלד בן אל-ווליד','31','אל-רוחי','7638294'),
('2024-01-23 08:05:05','חאלד בן אל-ווליד','31','אל-חנאגרי','7638294'),
('2024-01-23 10:12:12','התעשייה','20','אבו קאסם','8723451'),
('2024-01-24 07:45:50','האוניברסיטה','6','אל-עוקבי','8857394'),
('2024-01-24 07:45:50','האוניברסיטה','6','אבו רוקן','8857394'),
('2024-01-24 09:30:40','הים','44','אבו סובחי','8857394'),
('2024-01-24 12:20:20','פלסטין','19','אבו עווד','8857394'),
('2024-01-25 14:10:10','אחדות','37','אל-ברכאת','5789467'),
('2024-01-25 14:10:10','אחדות','37','אבו מדיעם','5789467'),
('2024-01-25 16:45:00','עומר אל-מוחתאר','50','אבו זעבול','8857394'),
('2024-01-26 08:00:00','נאצר','29','אבו חטואן','6847391'),
('2024-01-26 08:00:00','נאצר','29','אבו חמאדה','6847391'),
('2024-01-26 10:30:30','גמאל עבד אל נאצר','14','אבו קרערה','8723451'),
('2024-01-27 09:45:15','סלאח א דין','62','אל-דראוי','7638294'),
('2024-01-27 09:45:15','סלאח א דין','62','אבו אסעד','7638294'),
('2024-01-27 11:11:11','המלך פייסל','2','אל-זינתי','8723451')
GO


--יצירת טבלא 5, האזנות סתר לשיחות חשודות
CREATE TABLE Wiretapping
(CallID INT NOT NULL
, CallTimeStamp DATETIME NOT NULL
, CallerPhoneNumber VarChar (11) NOT NULL
, ReceiverPhoneNumber VarChar (11) NOT NULL
, SuspiciousWord Varchar (20)
, WiretapPN Char (7)						--המספר האישי של המאזין
, CONSTRAINT Wi_CalID_PK PRIMARY KEY (CallID)
, CONSTRAINT Wi_CalNum_CK CHECK (LEN(CallerPhoneNumber) IN (9,10,11))
, CONSTRAINT Wi_RecNum_CK CHECK (LEN(ReceiverPhoneNumber) IN (9,10,11))
, CONSTRAINT WI_PN_FK FOREIGN KEY (WiretapPN) REFERENCES IDF_Intelligence(PersonalNumber)
)
GO

--הכנסת נתונים לטבלא 5
INSERT INTO Wiretapping
VALUES
(1,'2024-01-21 03:34:05','059-7632016','059-3465787','התנקשות','5678390'),
(2,'2024-01-21 10:37:01','059-7632016','059-2328120','מטען','6789450'),
(3,'2024-01-21 14:38:33','059-2328120','082107364','אר-פי-גי','5678390'),
(4,'2024-01-21 18:14:18','059-2606474','0567246218','מטען','6789450'),
(5,'2024-01-21 19:20:32','059-4332003','0568280388','אר-פי-גי',NULL),
(6,'2024-01-22 09:29:57','059-8083136','082496535','התנקשות',NULL),
(7,'2024-01-22 11:31:30','059-0236547','082071585','למקש','7049582'),
(8,'2024-01-22 11:45:16','059-1354278','0566733144','מטען','7582941'),
(9,'2024-01-22 20:03:19','059-5931034','0597771702','לירות','7049582'),
(10,'2024-01-22 22:54:40','059-2328120','059-1171822','למקש','7582941'),
(11,'2024-01-22 23:45:37','059-1354278','0569331749','מטען','8457293'),
(12,'2024-01-23 00:01:25','059-9821465','082644708','מטען',NULL),
(13,'2024-01-23 04:02:02','059-7632016','059-6923226','לירות','5678390'),
(14,'2024-01-23 12:27:07','059-1171822','059-4957885','התנקשות','6789450'),
(15,'2024-01-23 13:44:43','059-8244935','059-4957885','אר-פי-גי','5678390'),
(16,'2024-01-23 14:46:33','059-7632016','059-3561595','מוקש','6789450'),
(17,'2024-01-23 20:44:56','059-5777387','082843925','לירות',NULL),
(18,'2024-01-24 07:09:28','059-1171822','082893508','לירות',NULL),
(19,'2024-01-24 10:44:05','059-5931034','059-0236547','מוקש','7049582'),
(20,'2024-01-24 15:49:37','059-6923226','0595191463','מטען','7582941'),
(21,'2024-01-25 00:52:48','059-4332003','082843873','לירות','7049582'),
(22,'2024-01-25 06:51:37','059-1354278','059-0033092','לירות','7582941'),
(23,'2024-01-25 09:31:07','059-5931034','059-6193990','לירות','8457293'),
(24,'2024-01-25 12:47:53','059-0236547','059-3561595','התנקשות',NULL),
(25,'2024-01-25 16:54:38','059-4873471','059-0033092','מטען','5678390'),
(26,'2024-01-25 20:57:56','059-2269166','082560915','מטען','6789450'),
(27,'2024-01-26 00:47:25','059-6193990','059-0236547','מוקש','5678390'),
(28,'2024-01-26 08:27:31','059-0236547','082485168','לירות','6789450'),
(29,'2024-01-26 12:58:54','059-0033092','059-0236547','לירות','6789450'),
(30,'2024-01-26 22:22:17','059-5931034','059-7632016','להרוג','8457293')
GO

/*   שאילתות המחזירות את כל הטבלאות
SELECT *
FROM Population

SELECT *
FROM Hamas_Forces

SELECT *
FROM IDF_Intelligence

SELECT *
FROM Observation

SELECT *
FROM Wiretapping
*/

--שאילתא המחזירה את סיכום העבודה שעשו התצפיתנים בשבוע זה
SELECT II.PersonalNumber, II.FirstName, II.LastName, II.Role, 'זיהה את' + '-->', ob.Ha_Nickname, ob.ObservationTimeStamp
FROM IDF_Intelligence II JOIN Observation OB
ON II.PersonalNumber = OB.IdentifierPN



-- שאילתא המחזירה את מעקב השיחות החשודות (טבלא 5) יחד עם שמות המשוחחים
SELECT W.CallID
,W.CallTimeStamp
,W.CallerPhoneNumber
,P_C.FirstName+' '+P_C.LastName AS 'Caller Name'
--, HF_C.Ha_Nickname
, CASE WHEN HF_C.Ha_Nickname IS NOT NULL THEN 'פעיל חמאס'
		 WHEN P_C.FirstName IS NOT NULL THEN 'תושב חאן יונס'
		 ELSE 'אדם מבחוץ'
  END AS 'Status'
 , W.ReceiverPhoneNumber
 , P_R.FirstName+ ' '+ P_R.LastName AS 'Receiver Nmae'
 --, HF_R.Ha_Nickname
, CASE WHEN HF_R.Ha_Nickname IS NOT NULL THEN 'פעיל חמאס'
		 WHEN P_R.FirstName IS NOT NULL THEN 'תושב חאן יונס'
		 ELSE 'אדם מבחוץ'
  END AS 'Status'
, W.WiretapPN
, ISNULL( II.FirstName+ ' ' +II.LastName, '!טרם בוצעה האזנה!') AS 'WiretapName'

FROM Wiretapping W LEFT JOIN Population P_C
	ON W.CallerPhoneNumber = P_C.Phone
 LEFT JOIN Hamas_Forces HF_C
	ON HF_C.Ha_ID_Number = P_C.Po_ID_Number
LEFT JOIN Population P_R
	ON P_R.Phone = W.ReceiverPhoneNumber
 LEFT JOIN Hamas_Forces HF_R
	ON HF_C.Ha_ID_Number = P_R.Po_ID_Number
LEFT JOIN IDF_Intelligence II
	ON W.WiretapPN = II.PersonalNumber